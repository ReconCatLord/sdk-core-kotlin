package network.xyo.sdkcorekotlin.boundWitness

import kotlinx.coroutines.runBlocking
import network.xyo.sdkcorekotlin.XyoTestBase
import network.xyo.sdkcorekotlin.hashing.basic.XyoBasicHashBase
import network.xyo.sdkcorekotlin.schemas.XyoSchemas
import network.xyo.sdkobjectmodelkotlin.objects.sets.XyoIterableObject
import org.junit.Assert
import org.junit.Test
import java.math.BigInteger

class XyoBoundWitnessInterpretTest : XyoTestBase() {

    @Test
    fun testInterpreterBoundWitness () {
        val boundWitnessBytes = BigInteger("A00200000167B0CC0000009AA0010000004A800C00000044E9940BD0839AB9BC2BF7D43C0C5D9F70649FB4464E33EEFA2CA253DE8E0C0A4E1B3BC277406C83FA3F1DAC8C6923459DE77689080B6E8AD82E977A037D6D2B5A0000004A800C00000044ABCC0E164B90F630B334C8B26C358C61C87D9D72A2130869D29C0B4B16DFF9311D5CE9B826240C038109B4BAC6ABC903190BB7271164E676409A0E828F1D5BF0B0CC00000022B0070000000EA00100000004000000040000000EA0010000000400000004B0CC000000A1A0010000004E8009000000482100B99BAE6E6D25858098982E7304110CE5C23D204C24ABC18DA7773E67F3DF24742100E7E7B665F290060BD69031C23514A109280D198352C22547A9EF25CE50AAF4E70000004D80090000004720520D8A0809E362F255BEE148C736528BF4C80152380C1452BACB851396BC11482100AA8DA1E12BF362368475FCC8863B56E4C71C3E25CCE5E899FC3EE32D37AD19F4", 16).toByteArray()
        val createdBoundWitness = XyoBoundWitness.getInstance(boundWitnessBytes.copyOfRange(1, boundWitnessBytes.size))

        Assert.assertEquals(2, XyoIterableObject(createdBoundWitness.publicKeys).size)
        Assert.assertEquals(2, XyoIterableObject(createdBoundWitness.payloads).size)
        Assert.assertEquals(2, XyoIterableObject(createdBoundWitness.signatures).size)
    }

    @Test
    fun testBoundWitnessHash () {
        runBlocking {
            val boundWitnessHash = BigInteger("801000000024D2C81E30305CADA018E449414B2973B3537F2DEED741271BF46C146D314E0288", 16).toByteArray()
            val boundWitnessBytes = BigInteger("A00200000167B0CC0000009AA0010000004A800C00000044E9940BD0839AB9BC2BF7D43C0C5D9F70649FB4464E33EEFA2CA253DE8E0C0A4E1B3BC277406C83FA3F1DAC8C6923459DE77689080B6E8AD82E977A037D6D2B5A0000004A800C00000044ABCC0E164B90F630B334C8B26C358C61C87D9D72A2130869D29C0B4B16DFF9311D5CE9B826240C038109B4BAC6ABC903190BB7271164E676409A0E828F1D5BF0B0CC00000022B0070000000EA00100000004000000040000000EA0010000000400000004B0CC000000A1A0010000004E8009000000482100B99BAE6E6D25858098982E7304110CE5C23D204C24ABC18DA7773E67F3DF24742100E7E7B665F290060BD69031C23514A109280D198352C22547A9EF25CE50AAF4E70000004D80090000004720520D8A0809E362F255BEE148C736528BF4C80152380C1452BACB851396BC11482100AA8DA1E12BF362368475FCC8863B56E4C71C3E25CCE5E899FC3EE32D37AD19F4", 16).toByteArray()
            val createdBoundWitness = XyoBoundWitness.getInstance(boundWitnessBytes.copyOfRange(1, boundWitnessBytes.size))

            val hash = createdBoundWitness.getHash(XyoBasicHashBase.createHashType(XyoSchemas.SHA_256, "SHA-256")).await().self
            Assert.assertArrayEquals(boundWitnessHash.copyOfRange(1, boundWitnessHash.size), hash)
        }
    }
}